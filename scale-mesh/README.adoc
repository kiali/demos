:imagesdir: images

# Scale Mesh

The scale mesh demo can be used for performance and scalability testing, as well as for exercising Kiali's graph feature.

You set variables to control the size, type, and scale of the mesh:

|===
| Environment Variable | Description | Default

| `MESH_TYPE`
| What the mesh topology will be (one of: `breadth`, `breadth-sink`, `circle`, `circle-callback`, `depth`, `depth-sink`, `hourglass`)
| circle

| `NUMBER_NAMESPACES`
| Total number of namespaces in the mesh
| 1

| `NUMBER_APPS`
| Total number of apps in the mesh
| 5

| `NUMBER_VERSIONS`
| Number of versions per app
| 2

| `NUMBER_SERVICES`
| Total number of services within the mesh
| 5

| `CONTROL_PLANE_NAMESPACE`
| Where Istio's control plane components are installed (this is only used when creating SMM resources within a Maistra environment)
| istio-system
|===

_(Acknowledgement: Much of this code was taken from https://github.com/kiali/kiali-test-mesh)_

## Install

To deploy the demo, use the `install` make target, with optional settings (see above) passed on the command line using the `-e` option.

For example:

```bash
make install -e MESH_TYPE=depth -e NUMBER_VERSIONS=3 -f <(curl -L https://raw.githubusercontent.com/kiali/demos/master/scale-mesh/Makefile)
```

## Uninstall

Pass the same arguments as before, only execute the `uninstall` target:

For example:

```bash
make uninstall -e MESH_TYPE=depth -e NUMBER_VERSIONS=3 -f <(curl -L https://raw.githubusercontent.com/kiali/demos/master/scale-mesh/Makefile)
```

## Build

This demo's link:https://quay.io/repository/kiali/scale-mesh-demo?tab=tags[docker image] is available on quay.io, but if you would like to build the docker image locally, you can do so by cloning this repository and running the `build` make target.

```bash
make build
```

## Mesh Types

|===
| Mesh Type | Graph

| breadth
| image:breadth.png[width=50%, height=50%]

| breadth-sink
| image:breadth-sink.png[width=50%, height=50%]

| circle
| image:circle.png[width=50%, height=50%]

| circle-callback
| image:circle-callback.png[width=40%, height=40%]

| depth
| image:depth.png[width=90%, height=90%]

| depth-sink
| image:depth-sink.png[width=40%, height=40%]

| hourglass
| image:hourglass.png[width=50%, height=50%]
|===
